# Общее описание

DNSniffer это программное обеспечение для поиска, анализа, эксплуатации Blind-уязвимостей, включающая в себя следующие основные компоненты:

* DNS-Sniffer. Модуль для получения и журналирования отстуков по DNS.
* InteractSH. Модуль для получения и отображения запросов c использованием следующих протоколов:
  * HTTP/S;
  * TCP/TLS;
  * SMTP/S;
  * LDAP/S;
  * FTP/S.
* XSSHunter. Модуль для получения и эксплуатации Blind-XSS уязвимостей. 
* DNSRebind. Модуль для перезаписи DNS записей с целью обхода механизмов фильтрации на стороне сервера. 
* DNS Blackhole. Модуль черных списков DNS

# Настройка системы и первый запуск

Для первоначальной настройки и работы системы необходимо приобрести любое доменное имя и прописать в настройках DNS вашего регистратора новый NS сервер и соответствующий ему IP-адрес, где будет располагаться запущенный инстанс нашей системы. 

Перед первым запуском необходимо заполнить и актуализировать информацию в файле настроек "config.json". Данный файл представляет собой JSON-документ.

## Файл настроек
JSON-файл с настройками содержит в себе следующие поля:

* web_server. Этот блок отвечает за основные настройки веб-интерфейса приложения и включает в себя следующие поля:
  * webserver\_url. Тип - string. Поле формата "<IP_ADDRESS>:<PORT>", в котором указывается на каком IP-адресе и порту будет слушать наш веб-сервер.
  * hostname. Тип - string. FQDN имя, которое резолвится в IP-адрес веб-приложения. Используется для проверки доступа к админке и подсистемы восстановления пароля учетных записей. В случае использования механизма multihandler доступ к админке возможен ТОЛЬКО по этому имени
  * use_tls. Тип - boolean. Флаг обозначащий использование TLS для установления защищенного соединения.
  * whitelist. Тип - []string. Список сетей из которых разрешен доступ к административной панели (если список пуст или есть адрес "*" - разрешено для всех)
* mongo_db. Этот блок отвечает за основные настройки базы данных.
  * db_path. Тип - string. URL Mongo db
  * db_user. Тип - string. Пользователь для подключения к БД
  * db_password. Тип - string. Пароль пользователя для подключения к БД
  * main\_db_name. Тип - string. Имя основной базы данных
  * dns\_db_name. Тип - string. Имя базы данных для настроек DNS, записей, rebind и blackhole
  * dns\_hits\_db_name. Тип - string. Имя базы данных данных DNS отстуков
  * interact\_db_name. Тип - string. Имя базы данных InteractSH
  * xsshunter\_db_name. Тип - string. Имя базы данных XSSHunter
* dns. Этот блок включает в себя основные настройки DNS сервера
  * primary_zone. Тип - []string. Список TLD зон, для которой наш сервер является NS
  * use_tcp.Тип - boolean. Слушать DNS запросы на TCP порту
  * use_udp. Тип - boolean. Слушать DNS запросы на UDP порту
  * tcpport. Тип - string. Номер TCP порта, на котором будет слушать DNS сервер
  * udpport. Тип - string. Номер UDP порта, на котором будет слушать DNS сервер
  * listenip. Тип - string. IP-адрес, на котором будет слушать DNS сервер
  * answerip.Тип - string. IP-адрес, которым будет отвечать DNS сервер по умолчанию на любые запросы
  * ttl. Тип - int. TTL DNS ответа
* interact. Этот блок включает в себя основные настройки InteractSH
  * listen_ip. Тип - string. IP-адрес, на котором будут слушать InteractSH
  * share_dir. Тип - string. Путь до папки с файлами, которая будет использоваться для шаринга через InteractSH сервера
* smtp. Этот блок включает в себя  основные настройки SMTP сервера, который будет использоваться для отправки писем при восстановлении паролей учетных записей
  * from. Тип - string. Адрес электронной почты, от имени которого будет совершаться отправка электронных писем
  * smtp\_server_address. Тип - string. IP-адрес SMTP-сервера
  * smtp\_server_port. Тип - int. Порт SMTP-сервера
  * smtp\_server_username. Тип - string. Имя пользователя, которое будет использоваться при подключении к SMTP-серверу
  * smtp\_server_password. Тип - string. Пароль пользователя, который будет использоваться при подключении к SMTP-серверу
  * use_tls. Тип - boolean. Использовать SMTPS для отправки электронных сообщений
  * verify_tls. Тип - boolean. Проверять сертификат SMTP-сервера при установке защищенного соединения
* xsshunter. Этот блок включает в себя основные настройки сервера XSSHunter
  * xsshunter_url. Тип - string. Поле формата "<IP_ADDRESS>:<PORT>", в котором указывается на каком IP-адресе и порту будет слушать наш сервер XSSHunter.
  * use_tls. Тип - boolean. Использовать защищенное соедение для XSSHunter
* ssl. Блок отвечает за настройки для хранения ssl сертификатов
  * path. Тип - string. Путь до папки в которой будут хранится сертификаты
* cookie. Блок отвечает за настроку параметров сессий и кук
  * name. Тип - string. Имя сессионной куки в системе
  * path. Тип - string. Путь на который выставляется куки
  * maxage. Тип - int. Время жизни сессии и куки
  * domain. Тип - string. Домен на который выставляется куки
* oidc. Блок отвечает за интеграцию с сервисами OIDC
  * enabled. Тип - boolean. Включение отключение входа через OIDC
  * provider_name. Тип - string. Отображаемое имя сервиса для входа 
  * oidc_url. Тип - string. Полный адрес сервиса OIDC (включая путь до используемого realm). Остальные url и настройки система получит сама при запросе ".well-known/openid-configuration"
  * client_id. Тип - string. Уникальное имя клиента в используемом OIDC
  * cleint_secret. Тип - string. Секрет клиента в используемом OIDC
  * create_users. Тип - string. Создавать пользователей входящих с помощью OIDC, если они ещё не зарегистрированы

## Перед запуском

В зависимости от того, скачали ли вы уже собранную версию или исходные коды, вам может потребоваться установить Golang. Для этого лучше использовать последнюю версию Go с официального [сайта](https://go.dev/doc/install).

Также дополнительно потребуется установить [MongoDB](https://www.mongodb.com/docs/manual/installation/). Если планируете использовать авторизацию в БД, то следует заранее создать аккаунт в Mongo с необходимыми правами.

Если вы планируете размещать админку и interactsh/xsshunter на одном интерфейсе/порте, то вам ничего не надо придумывать, система сама разрулит такую ситуацию на основе доменного имени в запросе. SSL сертификаты будут так же выбраны под имя хоста.

Для доступа к административной панели тербуется задать  в файле кофигурации доменное имя, по которому данный сервис будет доступен. Если вы не планируете использовать доменное имя для доступа к административной панели, то советуем вынести её на отдельный адрес и в поле конфигурации "hostname" указать его (для локльных тестов можно выставить "localhost"). 

## После запуска

* Открыть в браузере панель управления по адресу и порту, который указали в конфиге. 
* Залогиниться за админа `admin:admin` 
* Сменить пароль и настроить по своему усмотрению


## Работа с SSL сертификатами

В системе всегда существует  сертификат с именем default, который используется если нет ни одного подходящего. Он генерируется при старте сервера, если в системе нет ни одного сертифката. При попытке удалить данный сертификат из системы, будет сгенерирован новый и поставлен на его место.

Система предусматривает два варианта добаления новых сертифкатов - загрузку из файлов или создание сертификата с помощью Let's Encrypt.

При добавлении сертификата в ручном режиме (через загрузку файлов) необходимо чтобы ключ и сам сертификат были в PEM формате (формат где содержимое закодировано в base64 и стоит внутри "рамки").

Генерация сертифката с помощью Let's Encrypt использует механизм валидации с помощью DNS запросов, поэтому для генерации необходимо чтобы домен на который выписывает сертификат обслуживался текущим DNS сниффером.

Регенерация сертификатов с помощью Let's Encrypt происходит за 3 дня до их конечной даты в автоматическом режиме (если вы заранее включили данную функцию для этого сертификата).

Перезагрузка сертификатов происходит автоматически при любых действиях с любым из них.

Дополнительно: если необходимо заменить default сертификат но какой-то свой, то это необходимо сделать вручную, путем замены файлов в папке хранения сертификатов сервера. Такую замену можно производить "на лету", главное после этого нажать в интерфейсе кнопку принудительной перезагрузки сертифкатов.
